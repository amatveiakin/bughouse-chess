body {
  --sq-size-primary: min(5vw, 9vh);
  --sq-size-secondary: calc(var(--sq-size-primary) / 1.5);
  --board-size-primary: calc(var(--sq-size-primary) * 8);
  --board-size-secondary: calc(var(--sq-size-secondary) * 8);
  --reserve-height-in-squares: 1.5;
  --reserve-height-primary: calc(var(--sq-size-primary) * var(--reserve-height-in-squares));
  --reserve-height-secondary: calc(var(--sq-size-secondary) * var(--reserve-height-in-squares));

  --rem: max(calc(var(--sq-size-primary) * 0.25), 6pt);
  --dialog-rem: clamp(6pt, min(3vw, 2.5vh), 12pt);

  --rule-variant-button-width: 8em;
  --rule-variant-button-height: 7.5em;
  --rule-variant-buttons-gap: 0.7em;
  --rule-variant-buttons-per-row: 3;

  --color-chalk-myself: #2b7b00;
  --color-chalk-partner: #048ea2;
  --color-chalk-opponent: #d12727;
  --color-chalk-diagonal: #9a118b;
  --color-chalk-other: #404040;
  --color-chalk-other-light: #808080;
  --color-main-scrollbar: #597121;

  --color-dialog-background: #dfceb4;
  --color-dialog-scrollbar: #a18a18;
  --color-dialog-scrollbar-background: #c7bc7c;
  --color-dialog-tooltip: #c6bcad;

  --participant-status-icon-space: 0.25em;
}
body.symmetric {
  --sq-size-primary: min(4.4vw, 7.8vh);
  --sq-size-secondary: var(--sq-size-primary);
}
body.observer {
  --color-main-scrollbar: #71755e;
}

html, body {
  height: 100%;
  width: 100%;
  font-family: Verdana, sans-serif;
  /* TODO: Figure out why setting something to `1rem` doesn't behave exactly as `var(--rem)` */
  font-size: var(--rem);
  overflow: hidden;  /* disable scroll bars */
}
html {
  display: table;
  margin: auto;
}
body {
  background-color: #1c3a0c;
  color: #e0e0e0;
  display: table-cell;
  vertical-align: middle;
}
body.observer {
  background-color: #333333;
}
body.active-player {
  background: radial-gradient(circle farthest-corner, #1c3a0c 85%, #295313 100%);
  background-attachment: fixed;
}
table, tr, td, th {
  border: none;
  margin: 0;
  padding: 0;
}

svg {
  overflow: visible;  /* allow shadows outside of svg area */
}

#page {
  user-select: none;
}
#page {
  display: grid;
  grid-template-areas:
    ".        .         .  prim-rsrv-top     .           .         .        .         ."
    ".        .         .  prim-rsrv-top     .      scnd-rsrv-top  .        .         ."
    ".  prim-name-top   .  prim-rsrv-top     .      scnd-rsrv-top  .   scnd-name-top  ."
    ".  prim-clock-top  .   prim-board       .       scnd-board    .  scnd-clock-top  ."
    ".     prim-log     .   prim-board       .       scnd-board    .     scnd-log     ."
    ".     prim-log     .   prim-board       .       scnd-board    .  scnd-clock-bot  ."
    ".     prim-log     .   prim-board       .      scnd-rsrv-bot  .   scnd-name-bot  ."
    ".     prim-log     .   prim-board       .      scnd-rsrv-bot  .  scr-individual  ."
    ".     prim-log     .   prim-board       .          chat       .  scr-individual  ."
    ".  prim-clock-bot  .   prim-board       .          chat       .  scr-individual  ."
    ".  prim-name-bot   .  prim-rsrv-bot     .      action-panel   .  scr-individual  ."
    ".        .         .  prim-rsrv-bot     .      action-panel   .  scr-individual  ."
  ;
  grid-template-columns:
    1fr
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    calc(var(--sq-size-primary) * 1.2)
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    1fr
  ;
  grid-template-rows:
    repeat(4, auto)
    1fr
    repeat(7, auto)
  ;
}

body.symmetric #page {
  display: grid;
  grid-template-areas:
    ".        .         .  prim-rsrv-top     .      scnd-rsrv-top  .        .         ."
    ".  prim-name-top   .  prim-rsrv-top     .      scnd-rsrv-top  .   scnd-name-top  ."
    ".  prim-clock-top  .   prim-board       .       scnd-board    .  scnd-clock-top  ."
    ".     prim-log     .   prim-board       .       scnd-board    .     scnd-log     ."
    ".  prim-clock-bot  .   prim-board       .       scnd-board    .  scnd-clock-bot  ."
    ".  prim-name-bot   .  prim-rsrv-bot     .      scnd-rsrv-bot  .   scnd-name-bot  ."
    ".        .         .  prim-rsrv-bot     .      scnd-rsrv-bot  .  scr-individual  ."
    ".        .         .   action-panel     .          chat       .  scr-individual  ."
  ;
  grid-template-columns:
    1fr
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    calc(var(--sq-size-primary) * 1.2)
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    1fr
  ;
  grid-template-rows:
    repeat(3, auto)
    1fr
    repeat(4, auto)
  ;
}

#board-primary { grid-area: prim-board; }
#reserve-primary-top { grid-area: prim-rsrv-top; }
#reserve-primary-bottom { grid-area: prim-rsrv-bot; }
#player-name-container-primary-top { grid-area: prim-name-top; }
#player-name-container-primary-bottom { grid-area: prim-name-bot; }
#clock-container-primary-top { grid-area: prim-clock-top; }
#clock-container-primary-bottom { grid-area: prim-clock-bot; }
#turn-log-container-primary { grid-area: prim-log; }

#participant-container { grid-area: scr-individual; }

#board-secondary { grid-area: scnd-board; }
#reserve-secondary-top { grid-area: scnd-rsrv-top; }
#reserve-secondary-bottom { grid-area: scnd-rsrv-bot; }
#player-name-container-secondary-top { grid-area: scnd-name-top; }
#player-name-container-secondary-bottom { grid-area: scnd-name-bot; }
#clock-container-secondary-top { grid-area: scnd-clock-top; }
#clock-container-secondary-bottom { grid-area: scnd-clock-bot; }
#turn-log-container-secondary { grid-area: scnd-log; }

#chat-container { grid-area: chat; }
#action-panel { grid-area: action-panel; }

.display-none {
  display: none !important;
}
.fading {
  opacity: 0;
  transition: opacity 0.2s;
}
.inline-block {
  display: inline-block;
}
.visibility-hidden {
  visibility: hidden;
}
.overflow-visible {
  /* Mostly used to allow tooltips to go outside of the dialog area. */
  overflow: visible;
}
.full-width {
  width: 100%;
}
.align-left {
  width: 100%;
  text-align: left;
}
.align-right {
  width: 100%;
  text-align: right;
}
.align-center {
  width: 100%;
  text-align: center;
}
.valign-baseline {
  vertical-align: baseline;
}
.flex-row {
  display: flex;
  flex-direction: row;
  align-items: center;
}
.flex-row-full {
  width: 100%;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  gap: 0.5em;
}
.flex-col {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.flex-col-stretch {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
.flex-grow {
  flex-basis: 0;
  flex-grow: 1;
}
.gap-medium {
  gap: 0.5em;
}
.grid-col-span-2 {
  grid-column: span 2;
}

.board-shadow {
  fill: #808080;
  stroke: none;
  filter: url(#board-shadow);
}
.board-border {
  fill: none;
  stroke: #000000;
  stroke-width: 0.02;
}

.sq-black {
  fill: #e59349;
}
.sq-white {
  fill: #dfceb4;
}

.on-sq-black {
  fill: #dfceb4;
  font: normal 0.25px sans-serif;
}
.on-sq-white {
  fill: #e59349;
  font: normal 0.25px sans-serif;
}

.promotion-target-bg {
  fill: #84c0bc;
  stroke-width: 0.04;
  stroke: #1c8c9a;
  stroke-opacity: 0.5;
  opacity: 0.8;
}
.promotion-target-bg:hover {
  fill: #06baaf;
  stroke-width: 0.06;
  stroke: #007c8a;
  stroke-opacity: 1;
  opacity: 1;
}
.promotion-target-fg {
  pointer-events: none;
}
.promotion-target-bg + .promotion-target-fg {
  filter: opacity(0.8);
}
.promotion-target-bg:hover + .promotion-target-fg {
  filter: none;
}

.see-though-fog {
  opacity: 0.5;
}

.partial-turn-from-highlight {
  fill: #7dc3bf;
  opacity: 0.6;
}
.partial-turn-to-highlight,
.partial-turn-drop-highlight {
  fill: #70c3be;
  opacity: 0.6;
}

.partial-turn-from-above-highlight {
  fill: #a2d2cf;
  opacity: 0.5;
}
.partial-turn-to-above-highlight,
.partial-turn-drop-above-highlight {
  fill: #aafff9;
  opacity: 0.5;
}

.latest-turn-from-highlight {
  fill: #acbd38;
  opacity: 0.5;
}
.latest-turn-to-highlight {
  fill: #a7c000;
  opacity: 0.5;
}
.latest-turn-drop-highlight {
  fill: #4dcc7d;
  opacity: 0.5;
}

.pre-turn-from-highlight {
  fill: #7238bd;
  opacity: 0.5;
}
.pre-turn-to-highlight,
.pre-turn-drop-highlight {
  fill: #5800c0;
  opacity: 0.5;
}

.latest-turn-capture-highlight {
  fill: #ff889c;
  opacity: 0.6;
}
.latest-turn-capture-above-highlight {
  fill: #ff889c;
  opacity: 0.4;
}

.partial-turn-legaldestination-above-highlight {
  fill: url(#legal-move-gradient);
}
.partial-turn-dragstart-above-highlight-onwhite {
  fill: url(#drag-start-gradient-onwhite);
}
.partial-turn-dragstart-above-highlight-onblack {
  fill: url(#drag-start-gradient-onblack);
}
.ephemeral-dragover-highlight-onwhite {
  fill: url(#drag-over-gradient-onwhite);
}
.ephemeral-dragover-highlight-onblack {
  fill: url(#drag-over-gradient-onblack);
}

.draggable {
  cursor: grab;
}
.draggable.dragged {
  cursor: grabbing;
}

.duck-turn * {
  cursor: url("data:image/svg+xml,%3Csvg width='32' height='32' version='1.1' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m13 9.69c-2.21-1e-5 -3.92 1.57-4 3.78-0.0488 1.39 0.971 2.58 1.4 3.23-0.0565-0.0011-0.113-0.0018-0.17-0.0018-1.17-1.6e-5 -1.31 1.85-4.28 1.72-1.22-0.316-1.97-1.54-2.97-2.32-0.097-0.159-0.618-0.0738-0.772 0.609-0.225 1.57 0.353 4.01 0.76 5.72 0.673 2.53 3.39 4.11 6.53 4.11 3.69 6.1e-5 6.68-2.25 6.68-5.29-1.26e-4 -1.46-0.407-2.54-1.54-3.74 1-0.587 1.54-1.13 2.01-2.15l1.71-0.748c0.302-0.0419 0.397-0.431 0.149-0.608l-1.56-0.975c-0.329-1.92-1.99-3.32-3.94-3.32z' fill='none' stroke='%23000'/%3E%3Cpath d='m7.39 9.44-4.11 0.0709-3.28 2.48v-12z'/%3E%3C/svg%3E"), auto;
}

.chalk-arrow {
  fill: none;
  stroke-width: 0.25;
  stroke-linecap: butt;
  opacity: 0.6;
  pointer-events: none;
}
.chalk-freehand-line {
  fill: none;
  stroke-width: 0.15;
  stroke-linejoin: round;
  stroke-linecap: round;
  opacity: 0.6;
  pointer-events: none;
}
.chalk-square-highlight {
  stroke: none;
  opacity: 1.0;
  pointer-events: none;
}

.chalk-line-myself { stroke: var(--color-chalk-myself); }
.chalk-line-partner { stroke: var(--color-chalk-partner); }
.chalk-line-opponent { stroke: var(--color-chalk-opponent); }
.chalk-line-diagonal { stroke: var(--color-chalk-diagonal); }
.chalk-line-other { stroke: var(--color-chalk-other); }

.chalk-arrow.chalk-line-myself { marker-end: url(#arrowhead-myself); }
.chalk-arrow.chalk-line-partner { marker-end: url(#arrowhead-partner); }
.chalk-arrow.chalk-line-opponent { marker-end: url(#arrowhead-opponent); }
.chalk-arrow.chalk-line-diagonal { marker-end: url(#arrowhead-diagonal); }
.chalk-arrow.chalk-line-other { marker-end: url(#arrowhead-other); }

.chalk-square-myself { fill: var(--color-chalk-myself); }
.chalk-square-partner { fill: var(--color-chalk-partner); }
.chalk-square-opponent { fill: var(--color-chalk-opponent); }
.chalk-square-diagonal { fill: var(--color-chalk-diagonal); }
.chalk-square-other { fill: var(--color-chalk-other-light); }

#arrowhead-myself { fill: var(--color-chalk-myself); }
#arrowhead-partner { fill: var(--color-chalk-partner); }
#arrowhead-opponent { fill: var(--color-chalk-opponent); }
#arrowhead-diagonal { fill: var(--color-chalk-diagonal); }
#arrowhead-other { fill: var(--color-chalk-other); }

.board,
.reserve-container {
  touch-action: none;
}
#board-primary {
  width: var(--board-size-primary);
  height: var(--board-size-primary);
  z-index: 10;  /* show dragged pieces above other UI elements */
}
#board-secondary {
  width: var(--board-size-secondary);
  height: var(--board-size-secondary);
  z-index: 9;  /* show dragged pieces above other UI elements */
}
#reserve-primary-top,
#reserve-primary-bottom {
  width: var(--board-size-primary);
  height: var(--reserve-height-primary);
}
#reserve-secondary-top,
#reserve-secondary-bottom {
  width: var(--board-size-secondary);
  height: var(--reserve-height-secondary);
}
.reserve-piece-group {
  filter: url(#reserve-shadow);
}
body.observer .reserve-piece-group {
  filter: url(#reserve-shadow-gray);
}
.reserve-piece-group.reserve-highlight {
  filter: url(#reserve-highlight-shadow);
}

.glowing-steal {
  /* `sepia` + `hue-rotate` allows to colorize into a given color (in this case, blue);
     `contrast` + `saturate` + `brightness` are chosen to make both black and white pieces look ok */
  filter: contrast(0.9) sepia(0.3) saturate(2) brightness(1.05) hue-rotate(120deg) url(#glowing-steal);
}

.board.wayback .square-grid-layer {
  filter: saturate(0.5);
}
.board.wayback .piece-layer {
  filter: contrast(0.9);
}
.board.wayback .board-shadow {
  filter: url(#board-shadow-slim);
}
.board.wayback .board-border {
  stroke: #303030;
}


.player-name-container {
  position: relative;
  min-height: 2em;
}
#player-name-primary-top {
  position: absolute;
  bottom: 0;
  right: 0;
}
#player-name-primary-bottom {
  position: absolute;
  top: 0;
  right: 0;
}
#player-name-secondary-top {
  position: absolute;
  bottom: 0;
  left: 0;
}
#player-name-secondary-bottom {
  position: absolute;
  top: 0;
  left: 0;
}
.player-name {
  font-size: 110%;
  white-space: pre;
  color: #a4b984;
  padding: 0.6em 0;
}
body.observer .player-name {
  color: #b2b2b2;
}

.participant-item {
  white-space: nowrap;
  position: relative; /* for `.participant-status-icon` positioning */
}
.participant-name {
  padding-left: var(--participant-status-icon-space);
  font-family: "Open Sans", sans-serif;
}
.participant-name-l ,
.participant-name-xl {
  font-stretch: semi-condensed;
}
.participant-name-xxl {
  font-stretch: condensed;
  font-size: 90%;
}
.participant-name-xxxl {
  font-stretch: condensed;
  font-size: 80%;
}
.participant-status-icon-left {
  position: absolute;
  left: 0;
  transform: translateX(calc(-50% + var(--participant-status-icon-space) - 0.7em));
}
.participant-status-icon-right {
  position: absolute;
  right: 0;
  transform: translateX(calc(+50% - var(--participant-status-icon-space) + 0.7em));
}

#score-body,
#observers {
  color: #7fb5a1;
}
#participant-container {
  width: 0;
  display: flex;
  flex-direction: column;
}
#score-container {
  display: flex;
  flex-direction: row;
}
#score-body {
  white-space: pre;
  border-top: 0.2em solid #7fb5a1;
  margin-top: 1.5em;
  padding: 0.5em 0;
}
#observers {
  height: 0;
  font-size: 75%;
}
.score-player-name {
  max-width: 10em;
  font-size: 85%;
  line-height: 110%;
}
.score-first-player-name {
  padding-top: 0.6em;
}
.team-score-value {
  padding-top: 0.5em;
  padding-left: 0.5em;
  font-size: 120%;
  text-align: right;
}
.individual-score-table {
  min-width: 6em;
  border-spacing: 0 0.15em;
}
.individual-score-table td {
  vertical-align: baseline;
}
.individual-score-value {
  padding-left: 0.5em;
  font-size: 105%;
  text-align: right;
}
.individual-score-fraction {
  font-size: 105%;
}
.individual-score-total {
  padding-left: 0.15em;
  font-size: 80%;
  opacity: 0.6;
}
body.symmetric #score-body {
    padding: 0.4em 0;
}
body.symmetric .score-player-name {
    line-height: 100%;
}
body.symmetric .individual-score-value {
    line-height: 100%;
}

.clock {
  position: relative;
  font-family: Monaco, monospace;
  font-size: 180%;
  text-align: center;
  white-space: nowrap;
  min-width: 3em;
  display: inline-block;
  border-radius: calc(var(--sq-size-primary) * 0.2);
  padding: calc(var(--sq-size-primary) * 0.1);
  margin: calc(var(--sq-size-primary) * 0.05)  0;
}
.clock-inactive {
  color: #909090;
  background-color: #28351f;
  outline: calc(var(--sq-size-primary) * 0.03) solid #74935f;
}
.clock-active {
  font-weight: bold;
  color: #f0f0f0;
  background-color: #1f5800;
  outline: calc(var(--sq-size-primary) * 0.1) outset #63ba25;
}
.clock-active.clock-low-time {
  font-weight: bold;
  color: #f0f0f0;
  background-color: #435700;
  outline: calc(var(--sq-size-primary) * 0.1) outset #ddd712;
}
.clock-flag {
  font-weight: bold;
  color: #909090;
  background-color: #691400;
  outline: calc(var(--sq-size-primary) * 0.1) solid #bf0000;
}
body.observer .clock-inactive {
  background-color: #2a2a2a;
  outline-color: #8a8a8a;
}
body.observer .clock-active {
  background-color: #345423;
  outline-color: #85b363;
}
body.observer .clock-active.clock-low-time {
  background-color: #4a5616;
  outline-color: #dad26e;
}

.clock-difference {
  color: #b0b0b0;
  min-width: 2.4em;
  font-size: 50%;
  font-weight: normal;
  padding: 0 0.2em;
  border-radius: calc(var(--sq-size-primary) * 0.1);
  background-color: inherit;
  outline-color: inherit;
  outline-width: calc(var(--sq-size-primary) * 0.02);
  outline-style: solid;
}
.clock-difference-top {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translate(-50%, -65%);
}
.clock-difference-bot {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translate(-50%, 65%);
}
.clock-difference-lt {
  color: #ff9d92c0;
}
.clock-difference-eq {
  color: #e0e0e0a0;
}
.clock-difference-gt {
  color: #4dde4db0;
}

#clock-container-primary-top,
#clock-container-primary-bottom {
  text-align: right;
}
#clock-container-secondary-top,
#clock-container-secondary-bottom {
  text-align: left;
}

#chat-container {
  position: relative;
  font-size: 70%;
  color: #d0d0d0;
}
#chat-box {
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  position: relative;
  border-radius: 0.3em;
  border: 0.1em solid #00000040;
  width: var(--board-size-secondary);
  height: calc(var(--board-size-primary) - var(--board-size-secondary) - var(--reserve-height-secondary));
  overflow: hidden;
}
body.symmetric #chat-box {
  height: calc(var(--sq-size-primary) * 1.3);
}
#chat-text-area {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  gap: 0.2em;
  overflow-wrap: break-word;
  overflow-x: hidden;
  overflow-y: scroll;
  padding: 0.2em 0.4em 0.6em 0.4em;
  background-color: #00000020;
  user-select: text;
}
#chat-input-container {
  position: relative;
}
#chat-input {
  box-sizing: border-box;
  background-color: #00000040;
  width: 100%;
  height: 1.8em;
  border: none;
  box-shadow: 0 -0.1em 0.3em #00000080;
  color: inherit;
  font: inherit;
  padding: 0.3em;
  outline: none;
}
#chat-input:focus {
  box-shadow: 0 -0.2em 0.4em #00000080, inset 0 0 0.3em #7dca54;
}
#chat-send-button {
  position: absolute;
  right: 0.2em;
  width: 1.6em;
  height: 1.6em;
  border-radius: 0.5em;
  fill: #ffffff;
  padding: 0;
}
.chat-prefix {
  font-size: 80%;
  color: #d0d0d0e0;
  margin-right: 0.8em;
}
.chat-arrow {
  margin: 0 0.2em;
}
.chat-sender-myself,
.chat-recipient-myself {
  color: #5ac521c0;
  font-style: italic;
}
.chat-sender-all,
.chat-recipient-all {
  color: #c1cd1dc0;
  font-style: italic;
}
.chat-sender-system-error {
  color: #ce8080c0;
}
.chat-sender-system-game-over {
  color: #54d0d2c0;
}
.chat-message {
  position: relative;
  padding-left: 2em;
  text-indent: -2em;
}
.chat-message-unconfirmed::after {
  font-size: 80%;
  content: "ðŸ•";
  position: absolute;
  right: 0;
  bottom: 0;
  animation: clock-animation 1s linear infinite;
}
@keyframes clock-animation {
  0%  { content: "ðŸ•"; }
  8%  { content: "ðŸ•‘"; }
  17% { content: "ðŸ•’"; }
  25% { content: "ðŸ•“"; }
  33% { content: "ðŸ•”"; }
  42% { content: "ðŸ••"; }
  50% { content: "ðŸ•–"; }
  58% { content: "ðŸ•—"; }
  67% { content: "ðŸ•˜"; }
  75% { content: "ðŸ•™"; }
  83% { content: "ðŸ•š"; }
  92% { content: "ðŸ•›"; }
}

.chat-message-dimmed .chat-message-text {
  color: #d0d0d0c0;
}
.chat-message-prominent .chat-message-text {
  font-weight: bold;
  color: #e0e0e0;
}
.chat-message-flash {
  animation: chat-message-flash-animation 0.3s linear;
}
@keyframes chat-message-flash-animation {
	from { background-color: #ffffff20; }
	to { background-color: #ffffff00; }
}

#chat-reference-tooltip-container {
  border-radius: 0.3em;
  padding: 0.5em 0.7em;
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  transform: translateY(100%);
  background-color: #4a4535f0;
  box-shadow: 0 0 0.3em #4a4535;
  color: #c0c0c0;
}
#chat-reference-dialog-body {
  color: #202020;
  max-width: 55em;
}
#chat-reference-dialog-body td {
  vertical-align: top;
}
body.symmetric #chat-reference-tooltip-container {
  bottom: 2em;
  left: unset;
  right: 0;
  transform: unset;
}
#chat-reference-tooltip-hide {
  position: absolute;
  top: 0.2em;
  right: 0.4em;
  font-size: 90%;
}
#chat-reference-tooltip-hide {
  color: #84a9ff;
  text-decoration: underline;
  cursor: pointer;
}
.chat-reference-input {
  font-family: Monaco, monospace;
  white-space: nowrap;
}
.chat-reference-command {
  color: #ffffff;
  font-weight: bold;
}
.chat-reference-message {
  font-style: italic;
}
.chat-reference-separator,
.chat-reference-explanation {
  font-size: 90%;
}
dialog .chat-reference-input {
  padding-right: 1em;
}
dialog .chat-reference-command {
  color: #000000;
}
.chat-reference-group-separator {
  height: 1em;
}

dialog * {
  scrollbar-gutter: stable;
  scrollbar-color: var(--color-dialog-scrollbar) var(--color-dialog-scrollbar-background);
  scrollbar-width: auto;
}

/* Chrome prioritizes `scrollbar-...` over `::-webkit-scrollbar...`.
   And when the first one is active, it always creates regular think scrollbars.  */
@supports not selector(::-webkit-scrollbar) {
  #page * {
    scrollbar-gutter: stable;
    scrollbar-color: var(--color-main-scrollbar) #ffffff00;
    scrollbar-width: thin;
  }
}
#page ::-webkit-scrollbar {
  width: max(2px, 0.3em);
}
#page ::-webkit-scrollbar-track {
  background: none;
}
#page ::-webkit-scrollbar-thumb {
  background-color: var(--color-main-scrollbar);
}

.turn-log-container {
  padding: 1.2em 0;
}
#turn-log-container-primary {
  text-align: right;
}
#turn-log-container-secondary {
  text-align: left;
}
.turn-log-scroll-area {
  text-align: left;
  font-size: 80%;
  display: inline-block;
  height: 100%;
  overflow-x: visible;
  overflow-y: scroll;
  box-shadow: 0.05em 0.05em 0.2em #00000080;
}
.turn-log-scroll-area.wayback {
  box-shadow: 0.2em 0.2em 0.6em #000000ff;
}
.turn-log {
  height: 0;  /* make log scrollable rather than expandable */
  width: 7.8em;
  margin: 0.1em;  /* keep in sync with `.wayback-current-turn` outline */
}
/* Put scroll bars on the left */
#turn-log-scroll-area-primary { direction: rtl; }
#turn-log-primary { direction: ltr; }

.log-turn-record {
  box-sizing: border-box;
  padding: 0.15em 0.2em;
  overflow: hidden;
  font-family: "Open Sans", sans-serif;
  white-space: nowrap;
}
.wayback-current-turn-active {
  outline: 0.2em solid #00b000;
  outline-offset: -0.1em;
  border-radius: 0.5em;
}
.wayback-current-turn-inactive {
  outline: 0.15em solid #00b00080;
  outline-offset: -0.1em;
  border-radius: 0.5em;
}
.log-turn-record-white {
  background-color: #ffffff0c;
}
.log-turn-record-black {
  background-color: #0000001a;
}
.log-turn-record-intervention {
  background-color: #373c00;
}
.log-turn-number {
  display: inline-block;
  min-width: 3ch;
  font-size: 70%;
}
.log-record-xl .log-algebraic {
  font-stretch: semi-condensed;
}
.log-capture-separator {
  user-select: none;
  margin: 0 0.15em;
}
.log-record-l .log-capture-separator {
  margin: 0 0.1em;
}
.log-record-xl .log-capture-separator {
  margin: 0 0.07em;
}
.log-piece {
  display: inline-block;
  height: 1em;
  scale: 120%;
  margin-right: -0.3em;
  transform: translateY(0.06em);
}
.log-record-l .log-piece {
  scale: 120%;
  margin-right: -0.35em;
}
.log-record-xl .log-piece {
  scale: 110%;
  margin-right: -0.4em;
}
.log-piece-white {
  opacity: 75%;
}
.log-piece-black {
  background: radial-gradient(circle farthest-corner, #ffffff28 50%, #ffffff00 80%);
}
.log-steal-icon {
  width: 1.5em;
  height: 1em;
  margin-right: 0.1em;
}

#button-panel {
  margin-top: 1em;
  display: flex;
  flex-direction: row;
  gap: 0.2em;
  justify-content: space-between;
}
body.symmetric #button-panel {
  margin-top: 0;
}
.button-subpanel {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.2em;
}

#cannot-start-alert {
  margin-top: 0.3em;
  color: #ffa0a0;
  width: var(--board-size-secondary);
}
#cannot-start-alert::before {
  content: "â›” ";
}

#connection-info {
  position: absolute;
  top: 0.5em;
  right: 0.5em;
  font-size: 60%;
  color: #ffffff60;
  z-index: -10;
}
#connection-info.bad-connection {
  font-weight: bold;
  background-color: #ffd0d0c0;
  border: 0.5em solid transparent;
  color: #6e0000;
}

#cookie-banner {
  width: 100%;
  position: absolute;
  bottom: 0;
  left: 0;
  z-index: 110;
  padding: 1em 2em;
  box-sizing: border-box;
  background: #1b4f00;
  box-shadow: 0 0 0.4em #000000c0;
}
#cookie-warning {
  margin-right: 1em;
}
#cookie-warning ul {
  margin: 0.3em 0;
}
#cookie-warning li {
  margin: 0.1em 0;
}
#cookie-banner button {
  width: 100%;
  white-space: pre;
  background-color: #95b883;
}
#cookie-banner button:hover {
  background-color: #a6c497;
}
#accept-all-cookies-button {
  font-weight: bold;
}

button {
  display: inline-block;
  padding: 0.5em 1em;  /* if changed, adjust `translateX` in `#google-logo` */
  margin: 0.35em 0;
  border: 0;
  font-size: 1em;
  text-align: center;
  color: #101010;
  border-radius: 0.5em;
  background-image: linear-gradient(to top left,
                                    rgba(0, 0, 0, 0.1),
                                    rgba(0, 0, 0, 0.1) 30%,
                                    rgba(0, 0, 0, 0));
  box-shadow: inset 2px 2px 3px rgba(255, 255, 255, .6),
              inset -2px -2px 3px rgba(0, 0, 0, .6);
}
button:active:enabled:not(.icon-button) {
  transform: translate(0.1em, 0.1em);
  box-shadow: inset -2px -2px 3px rgba(255, 255, 255, .6),
              inset 2px 2px 3px rgba(0, 0, 0, .6);
}
button:disabled:not(.icon-button) {
  color: #606060;
  background-color: #d0d0d0;
}

.tooltip-standalone,
.tooltip-right,
.tooltip-below {
  position: relative;
}
.tooltip-standalone {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  margin-left: 0.6em;
  width: 1.5em;
}

.tooltip-text {
  visibility: hidden;
  text-align: initial;
  font-style: normal;
  font-weight: normal;
  font-size: calc(0.9 * var(--dialog-rem));
  width: 18em;
  background-color: var(--color-dialog-tooltip);
  padding: 0em 1em;
  border-radius: 0.5em;
  position: absolute;
  z-index: 1;
  top: 0%;
  left: 100%;
  margin: 0 0 0 1.8em;
  opacity: 0;
  box-shadow: 0.2em 0.2em 0.4em #00000080;
  transition: opacity .3s;
  transform: translate(0, -50%) translate(0, 2em);
}
.tooltip-below .tooltip-text {
  width: 20em;
  top: 100%;
  left: 50%;
  margin: 1.2em 0 0 0;
  transition-delay: 0.5s;
  transform: translate(-50%, 0) translate(0, 0);
}

/* Tooltip arrow */
.tooltip-text::after {
  content: "";
  position: absolute;
  top: 50%;
  right: 100%;
  margin: -0.5em 0 0 0;
  border-width: 0.5em;
  border-style: solid;
  border-color: transparent var(--color-dialog-tooltip) transparent transparent;
}
.tooltip-below .tooltip-text::after {
  top: 0%;
  right: 50%;
  margin: -1em 0 0 0;
  border-color: transparent transparent var(--color-dialog-tooltip) transparent;
}

.tooltip-standalone::after {
  font-size: 110%;
  height: 1lh;
  content: "â“˜";
}
.tooltip-standalone:hover::after {
  content: "ðŸ“–";
}
.tooltip-standalone.tooltip-standalone-small::after {
  font-size: 90%;
}
.tooltip-standalone:hover {
  cursor: help;
}
.tooltip-standalone:hover .tooltip-text,
.tooltip-below:hover .tooltip-text,
.tooltip-right:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

dialog {
  background-color: var(--color-dialog-background);
  font-size: var(--dialog-rem);
  padding: 0.6em 1em;
  overflow: auto;
}

#menu-dialog {
  min-width: 18em;
  padding: 0;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 100;
}
#menu-backdrop {
  background-color: #000000a0;
  z-index: 80;
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  transition: background-color 0.2s;
}

dialog::backdrop {
  background-color: #000000a0;
}

body.game-archive-preview #menu-backdrop {
  background-color: #00000040;
}
dialog {
  transition: opacity 0.2s, filter 0.2s;  /* for `.game-archive-preview` */
}
body.game-archive-preview dialog {
  mask-image: linear-gradient(
    #0000 calc(var(--menu-dialog-mouse-y) - 20%),
    #000f calc(var(--menu-dialog-mouse-y) - 7%),
    #000f calc(var(--menu-dialog-mouse-y) + 7%),
    #0000 calc(var(--menu-dialog-mouse-y) + 20%)
  );
  opacity: 0.8;
  filter: grayscale(25%);
}
.game-archive-hovered-row {
  text-shadow: 0 0 .65px #222, 0 0 .65px #222;
}
.view-archive-game {
  cursor: pointer;
  user-select: none;
}

.menu-page {
  min-width: 18em;
  padding: 0.6em 1em;
}
.menu-page-body {
  display: grid;
  grid-template-columns: auto 1fr auto;
  grid-auto-rows: 2.8em;
}

.label,
label {
  display: flex;
  align-items: center;
  /* Note: prefer padding over `column-gap`, because this way the entire line is clickable. */
  padding-right: 1em;
}
.fixed-form-value {
  font-weight: bold;
  display: inline-flex;
  align-items: center;
}

dialog hr {
  border: none;
  border-top: 1px solid #ab8562;
  overflow: visible;
  text-align: center;
  height: 0;
  margin: 1em 0;
}
dialog hr:after {
  background: var(--color-dialog-background);
  color: #785636;
  content: 'â™ž';
  padding: 0 0.4em;
  position: relative;
  top: -0.85em;
  display: inline-block;
}
dialog hr:nth-of-type(even):after {
  transform: scale(-1, 1);
}

dialog button {
  background-color: #eed5ae;
}
dialog button:hover:enabled {
  background-color: #f3debd;
}

.big-button {
  width: 14em;
  font-size: 1.3em;
  text-shadow: 0.05em 0.05em 0.05em #eaac73;
  background-color: #e59f5f;
}
.big-button:hover:enabled {
  background-color: #eaac73;
}
.big-button:disabled {
  color: #606060;
  text-shadow: none;
  background-color: #d0d0d0;
}

.big-button.danger-button {
  text-shadow: 0.05em 0.05em 0.05em #f37676;
  background-color: #f06a6a;
}
.big-button.danger-button:hover {
  background-color: #f37676;
}

.button-icon {
  height: 1ex;
  scale: 180%;
  fill: #202020;
}

.square-button {
  padding: 0;
  height: 2em;
  width: 2em;
  border-radius: 0.3em;
  display: flex;
  align-items: center;
  justify-content: center;
}
.square-button-icon {
  height: 1.2em;
  width: 1.2em;
}

dialog select, dialog input {
  display: block;
  box-sizing: border-box;
  padding: 0.3em 1em;
  margin: 0.3em 0em;
  width: 100%;
  font-size: 1.1em;
  border-width: 1px;
  border-color: #808080;
  border-radius: 0.2em;
  background-color: #f0e8dc;
}

/* Filter by `[type=text]` to avoid highlighting short passwords.
   The point of `:not(:placeholder-shown)` is to not make the cursor red if the input field is blank.
   Here `:placeholder-shown` is an emptiness marker. Could switch to `:blank` if it's standardized. */
dialog input[type=text]:invalid:not(:placeholder-shown) {
  color: red;
}

#jc-match-id:not(:placeholder-shown) {
  /* This is of course a purely visual change. Actual input should be uppercased in JS. */
  text-transform: uppercase;
}

.app-title-bar {
  padding: 0.2em 1em 0.3em;
  margin-bottom: 0.2em;
  background-color: #c4a87f;
  box-shadow: 0 0 0.4em #000000c0;
  font-size: 90%;
}
.app-title {
  font-family: Trebuchet MS, sans-serif;
  font-weight: bold;
}
.app-title-suffix {
  color: #00000080;
}
.app-logo {
  height: 1.2em;
  transform: translateY(0.12em);
  padding-right: 0.1em;
}

#google-logo {
  height: 1em;
  filter: url(#google-logo-shadow);
  transform: translateX(-0.4em) scale(200%);
}
.logged-in-as-prefix {
  font-size: 80%;
}
.account-guest {
  font-style: italic;
}
.account-user {
  font-weight: bold;
}
#account-deletion-warning {
  width: 24em;
  padding: 0.4em 0 1em 0;
}

.rule-variant-button {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-around;
  width: var(--rule-variant-button-width);
  height: var(--rule-variant-button-height);
  height: 7.5em;
  margin: 0;
}
.rule-variant-off {
  color: #000000c0;
}
.rule-variant-on {
  font-weight: bold;
  background-image: linear-gradient(to top left,
                                    rgba(230, 224, 0, 0.5),
                                    rgba(230, 224, 0, 0.5) 30%,
                                    rgba(230, 224, 0, 0.1));
  box-shadow: inset 1px 1px 2px rgba(255, 255, 255, .4),
              inset -1px -1px 2px rgba(0, 0, 0, .4);
}
.rule-variant-icon {
  display: block;
  height: 4em;
}
.rule-variant-button-caption {
  min-height: 2lh;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
#cc-rule-variants {
  margin: 0.5em 0 1em 0;
  max-width: calc(
    var(--rule-variant-button-width) * var(--rule-variant-buttons-per-row) +
    var(--rule-variant-buttons-gap) * (var(--rule-variant-buttons-per-row) - 1) +
    0.1em
  );
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 0.7em;
  justify-content: center;
}
#cc-rule-details {
  font-size: 85%;
}

.readonly-rules-match-caption {
  font-size: 110%;
}
.readonly-rule-caption {
  padding-right: 1em;
  font-size: 85%;
  /* Set `white-space: nowrap` to compensate `width: 100%` in the value column */
  white-space: nowrap;
  color: #000000c0;
}
.readonly-rule-variant {
  font-size: 110%;
  width: 100%;
}
.readonly-rule-variant-icon {
  width: 0;
  padding: 0 0.3em 0 0;
}
.readonly-rule-variant-icon .rule-variant-icon {
  width: 1.5em;
  height: 1.5em;
}
.readonly-rule-separator {
  height: 0.7em;
}
.readonly-rule-detail {
  font-size: 95%;
  width: 100%;
}

.match-rules-body {
  max-width: 20em;
}

#menu-lobby-page {
  width: 24em;
}
#lobby-participants {
  min-width: 10em;
  font-size: 110%;
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  column-gap: 0.5em;
  row-gap: 0.5em;
  align-items: center;
  user-select: none;  /* prevent accidental name selection when choosing a team */
}
#lobby-match {
  font-size: 110%;
}
.lobby-match-id {
  font-weight: bold;
}
#lobby-footer {
  position: relative;
  text-align: center;
  height: 2.5em;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.5em;
  box-sizing: border-box;
}
#lobby-footer.countdown {
  border: 0.15em solid #a36125;
}
#lobby-waiting {
  width: 90%;
  font-size: 90%;
}
#lobby-footer.countdown > #lobby-waiting {
  display: none;
}
#lobby-countdown {
  display: none;
  font-size: 110%;
  text-shadow: -0.05em -0.05em 0.1em #ffffff60, 0.05em 0.05em 0.1em #00000060;
}
#lobby-footer.countdown > #lobby-countdown {
  display: unset;
}
#lobby-countdown-seconds {
  font-weight: bold;
}
#lobby-countdown-progressbar {
  position: absolute;
  left: 0;
  top: 0;
  background-color: #a3612580;
  width: 0%;
  height: 100%;
  z-index: -10;
}
#lobby-footer.countdown > #lobby-countdown-progressbar {
  width: 100%;
  transition: width 3s linear;
}
.lobby-icon {
  width: 2em;
  height: 2em;
}
.lobby-icon.registered-user-icon {
  width: 1em;
  height: 1em;
}
.lobby-name-xl {
  font-size: 90%;
}
.lobby-name.lobby-me {
  text-shadow: -0.05em -0.05em 0.1em #ffffff40, 0.05em 0.05em 0.1em #00000040;
  font-weight: bold;
}
.lobby-me .readiness-checkbox { stroke: #82a12f; }
.lobby-me .readiness-checkmark { stroke: #5c9611; }
.lobby-other .readiness-checkbox { stroke: #978e86; }
.lobby-other .readiness-checkmark { stroke: #a49141; }
.lobby-icon.lobby-me {
  scale: 130%;
}
.lobby-icon.lobby-me > *:first-child {
  filter: url(#icon-shadow);
}
.lobby-icon:not(.lobby-me) {
  filter: saturate(0.9) contrast(0.7) brightness(1.1);
}

.fixed-head-table {
  position: relative;
  overflow-x: hidden;
  overflow-y: scroll;
  max-height: 75vh;
}
.fixed-head-table thead th {
  position: sticky;
  top: 0;
  z-index: 1;
}
.embossed-table {
  min-width: 36em;
  min-height: 20em;
  border-spacing: 0;
  border-collapse: separate;  /* required for sticky scrolling */
  background-color: #00000008;
}
.embossed-table td,
.embossed-table th {
  padding: 0.2em 0.5em;
}
.embossed-table th {
  border-left: 0.1em solid #00000040; /* no border from the scrollbar side */
  border-top: 0.1em solid #00000040;
  border-bottom: 0.1em solid #00000040;
}
.embossed-table tbody td {
  border-left: 0.1em solid #00000020; /* no border from the scrollbar side */
  border-bottom: 0.1em solid #00000020; /* top border handled by header */
}
.embossed-table thead th {
  /* must use non-transparent color because of sticky scrolling */
  background-color: #b4a68c;
}

#archive-game-table {
  font-size: 90%;
}
.game-archive-placeholder-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.game-archive-result-victory {
  background-color: #00ff001a;
}
.game-archive-result-defeat {
  background-color: #ff000016;
}
.game-archive-result-draw {
  background-color: #80808016;
}
.game-archive-me,
.game-archive-double-play {
  font-weight: bold;
  font-size: 90%;
  color: #444;
}

.dot {
  display: inline-block;
  animation-name: bouncing;
  animation-duration: 1000ms;
  animation-iteration-count: infinite;
  animation-timing-function: ease-out;
}
.dot:nth-child(2) {
  animation-delay: 125ms;
}
.dot:nth-child(3) {
  animation-delay: 250ms;
}
@keyframes bouncing {
  0%  { transform: none; }
  20% { transform: translateY(-.3em); }
  40% { transform: none; }
}

.simple-dialog-message {
  font-size: 110%;
  max-width: 36em;
}
.simple-dialog-button-box {
  float: right;
  margin-left: 4em;
  margin-top: 0.5em;
  display: flex;
  flex-direction: row;
  gap: 0.6em;
}
.simple-dialog-button-box > button {
  min-width: 6em;
}

.icon-button {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
  border: none;
  border-radius: calc(var(--sq-size-primary) * 0.2);  /* for hover hightlight */
  background-color: transparent;
  background-image: none;
  box-shadow: none;
  width: calc(var(--sq-size-primary) * 0.6);
  height: calc(var(--sq-size-primary) * 0.6);
  cursor: pointer;
}
.icon-button:hover {
  background-color: #ffffff30;
}
.icon-button:active {
  background-color: #ffffff50;
}

.inline-icon {
  display: inline-block;
  height: 1.6em;
}
.icon-button-svg {
  fill: #ffffff;
}
.icon-button-svg:active {
  fill: #ceffb4;
}

#ready-button-caption {
  padding-left: 0.2em;
  font-size: 150%;
}
